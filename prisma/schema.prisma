generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  SUPER_ADMIN
  OWNER
  SELLER
}

enum LeadStatus {
  NEW
  CONTACTED
  VISITED
  CLOSED_SALE
  LOST
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String
  role          Role      @default(SELLER)
  storeId       String?
  store         Store?    @relation(fields: [storeId], references: [id])
  leadsManaged  Lead[]    @relation("SellerLeads")
  createdAt     DateTime  @default(now())
}

model Store {
  id              String   @id @default(cuid())
  name            String
  slug            String   @unique
  cnpj            String   @unique
  address         String
  plan            String   
  subscriptionActive Boolean @default(true)
  ownerName       String
  
  users           User[]   
  vehicles        Vehicle[]
  leads           Lead[]
  sales           Sale[]
}

model Vehicle {
  id          String         @id @default(cuid())
  model       String
  brand       String
  year        Int
  price       Float
  km          Int
  description String?
  isAvailable Boolean        @default(true)
  storeId     String
  store       Store          @relation(fields: [storeId], references: [id])
  leads       Lead[]
  images      VehicleImage[]
}

model VehicleImage {
  id        String  @id @default(cuid())
  url       String
  vehicleId String
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
}

model Lead {
  id            String     @id @default(cuid())
  customerName  String
  customerPhone String
  status        LeadStatus @default(NEW)
  value         Float?     
  
  storeId       String
  store         Store      @relation(fields: [storeId], references: [id])
  vehicleId     String?
  vehicle       Vehicle?   @relation(fields: [vehicleId], references: [id])
  sellerId      String?
  seller        User?      @relation("SellerLeads", fields: [sellerId], references: [id])
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
}

model Sale {
  id            String   @id @default(cuid())
  value         Float    
  commission    Float    
  isValidated   Boolean  @default(false)
  
  storeId       String
  store         Store    @relation(fields: [storeId], references: [id])
  leadId        String   @unique
  createdAt     DateTime @default(now())
}